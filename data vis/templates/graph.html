<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Misinformation Analysis Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
    <h1>Misinformation Analysis Dashboard</h1>

    <!-- Tab Navigation -->
    <ul class="nav nav-tabs">
        <li class="nav-item">
            <a class="nav-link active" href="#sentiment" data-bs-toggle="tab">Sentiment Distribution</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#frequency" data-bs-toggle="tab">Frequency Over Time</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#map" data-bs-toggle="tab">Map of Locations</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#keywords" data-bs-toggle="tab">Top Keywords</a>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content">
        <div class="tab-pane fade show active" id="sentiment">
            <canvas id="sentimentChart"></canvas>
        </div>
        <div class="tab-pane fade" id="frequency">
            <canvas id="frequencyChart"></canvas>
        </div>
        <div class="tab-pane fade" id="map">
            <div id="map" style="height: 400px;"></div>
        </div>
        <div class="tab-pane fade" id="keywords">
            <ul id="keywordsList"></ul>
        </div>
    </div>

    <script>
        // Sentiment Chart
        const sentimentCtx = document.getElementById('sentimentChart').getContext('2d');
        const sentimentChart = new Chart(sentimentCtx, {
            type: 'pie',
            data: {
                labels: {{ sentiments_json | safe }},
                datasets: [{
                    data: {{ sentiment_values_json | safe }},
                    backgroundColor: ['rgba(255, 99, 132, 0.6)', 'rgba(54, 162, 235, 0.6)', 'rgba(255, 206, 86, 0.6)'],
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });

        // Frequency Chart
        const frequencyCtx = document.getElementById('frequencyChart').getContext('2d');
        const frequencyChart = new Chart(frequencyCtx, {
            type: 'line',
            data: {
                labels: {{ time_labels_json | safe }},
                datasets: [{
                    label: 'Posts Count',
                    data: {{ time_values_json | safe }},
                    borderColor: 'rgb(75, 192, 192)',
                    tension: 0.1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                },
                responsive: true,
                maintainAspectRatio: false
            }
        });

        // Map setup
        var map = L.map('map').setView([20, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: 'Â© OpenStreetMap'
        }).addTo(map);
        var locations = {{ locations_json | safe }};
        locations.forEach(function(loc) {
            if (loc.coordinates) {
                L.marker([loc.coordinates[0], loc.coordinates[1]]).addTo(map)
                    .bindPopup(loc.name);
            }
        });

        // Keywords List
        const keywordsList = document.getElementById('keywordsList');
        const keywords = {{ keywords_json | safe }};
        for (const [word, count] of Object.entries(keywords)) {
            const li = document.createElement('li');
            li.textContent = `${word}: ${count}`;
            keywordsList.appendChild(li);
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
